<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CuidAR | Home</title>
  <link rel="icon" type="image/svg+xml" href="../img/favicon.svg"><text y='0.9em' font-size='90'></text></svg>
  <link rel="stylesheet" href="../CSS/style.css">
  <link rel="stylesheet" href="../CSS/sidebar.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.6.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.6.0/uicons-thin-rounded/css/uicons-thin-rounded.css'>
  <script src="../JS/theme.js"></script>
</head>
<body>
  <div class="container main-feed-container">
    <!-- Top Bar con logo y título -->
    <div class="top-bar">
        <div class="top-bar-left">
            <i class="fas fa-bars menu-icon"></i>
            <span class="app-name">CuidAR</span>
        </div>
        <button id="logout-btn" class="btn-logout" title="Cerrar Sesión">
            <i class="fas fa-sign-out-alt"></i>
        </button>
    </div>
    
    <div class="main-logo-container">
        <img src="../img/logo3.jpg" alt="CuidAR Logo" class="main-logo" id="mainLogo">
        <div class="hearts-container" id="heartsContainer"></div>
    </div>
    
    <div class="main-subtitle">
        <p>Red de atención</p>
    </div>
    
    <div class="main-header">
        <h1 id="rotatingPhrase">Cuida tu salud antes que lo pida tu cuerpo</h1>
    </div>
    
    <!-- Carrusel de imágenes -->
    <div class="carousel-main">
        <img src="../img/1.jpg" alt="Slide 1" class="carousel-img-main active">
        <img src="../img/2.jpg" alt="Slide 2" class="carousel-img-main">
        <img src="../img/3.jpg" alt="Slide 3" class="carousel-img-main">
        <img src="../img/4.jpg" alt="Slide 4" class="carousel-img-main">
        <img src="../img/5.jpg" alt="Slide 5" class="carousel-img-main">
    </div>
    
    <div class="main-actions">
        <button class="btn btn-dark-main" onclick="window.location.href='test-diabetes.html'">
            <span>Test Diabetes e Hipertensión</span>
            <i class="fi fi-rr-stethoscope"></i>
        </button>
        <button class="btn btn-dark-main" onclick="window.location.href='test-psicologico.html'">
            <span>Test Psicológico</span>
            <i class="fi fi-tr-hand-holding-heart"></i>
        </button>
        <button class="btn btn-light-main" onclick="window.location.href='historia-clinica.html'">
            <span>Mi Historia Clínica</span>
            <i class="fi fi-rr-duplicate"></i>
        </button>
        <button class="btn btn-light-main" onclick="window.location.href='consejos-prevencion.html'">
            <span>Consejos de Prevención</span>
            <i class="fi fi-tr-flame"></i>
        </button>
        <button class="btn btn-light-main" onclick="accessAdmin()" style="margin-top: 1rem; background: linear-gradient(135deg, #ff9800, #ff5722); color: white;">
            <span>🔐 Panel de Administración</span>
            <i class="fas fa-users-cog"></i>
        </button>
    </div>
  </div>
  <!-- Panel de Notificaciones -->
  <div class="notifications-panel" id="notificationsPanel">
    <div class="notifications-header">
      <h3><i class="fas fa-bell"></i> Notificaciones</h3>
      <button class="btn-close-notifications" id="closeNotifications">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="notifications-body" id="notificationsBody">
      <!-- Las notificaciones se cargarán aquí -->
    </div>
    <div class="notifications-footer">
      <button class="btn-clear-notifications" id="clearNotifications">
        <i class="fas fa-trash"></i> Limpiar todas
      </button>
    </div>
  </div>
  
  <!-- Overlay para cerrar panel -->
  <div class="notifications-overlay" id="notificationsOverlay"></div>
  
  <!-- Menú Lateral (Sidebar) -->
  <div class="sidebar-menu" id="sidebarMenu">
    <div class="sidebar-header">
      <img src="../img/logo3.jpg" alt="CuidAR Logo" class="sidebar-logo">
      <h2>CuidAR</h2>
      <button class="btn-close-sidebar" id="closeSidebar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="sidebar-content">
      <!-- Sección de Sugerencias -->
      <div class="sidebar-section">
        <h3><i class="fas fa-lightbulb"></i> Sugerencias</h3>
        <ul class="sidebar-list">
          <li><i class="fas fa-check-circle"></i> Realiza tus tests periódicamente</li>
          <li><i class="fas fa-check-circle"></i> Mantén actualizada tu historia clínica</li>
          <li><i class="fas fa-check-circle"></i> Revisa tus notificaciones diariamente</li>
          <li><i class="fas fa-check-circle"></i> Sigue los consejos de prevención</li>
          <li><i class="fas fa-check-circle"></i> Consulta con profesionales de salud</li>
        </ul>
      </div>
      
      <!-- Sección de Contacto -->
      <div class="sidebar-section">
        <h3><i class="fas fa-address-book"></i> Contáctanos</h3>
        <ul class="sidebar-contact">
          <li>
            <i class="fas fa-envelope"></i>
            <a href="mailto:elimelecjoser@gmail.com">elimelecjoser@gmail.com</a>
          </li>
          <li>
            <i class="fas fa-phone"></i>
            <a href="tel:+573218154994">+57 321 815 4994</a>
          </li>
          <li>
            <i class="fab fa-whatsapp"></i>
            <a href="https://wa.me/573218154994" target="_blank">WhatsApp</a>
          </li>
          <li>
            <i class="fas fa-globe"></i>
            <a href="https://www.cuidar.com" target="_blank">www.cuidar.com</a>
          </li>
        </ul>
      </div>
      
      <!-- Redes Sociales -->
      <div class="sidebar-section">
        <h3><i class="fas fa-share-alt"></i> Síguenos</h3>
        <div class="sidebar-social">
          <a href="https://facebook.com" target="_blank" class="social-btn facebook">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="https://twitter.com" target="_blank" class="social-btn twitter">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="https://instagram.com" target="_blank" class="social-btn instagram">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="https://linkedin.com" target="_blank" class="social-btn linkedin">
            <i class="fab fa-linkedin-in"></i>
          </a>
        </div>
      </div>
      
      <!-- Información de la App -->
      <div class="sidebar-section sidebar-version">
        <h3><i class="fas fa-info-circle"></i> Información</h3>
        <div class="app-info">
          <p><strong>Versión:</strong> 2.0.1</p>
          <p><strong>Última actualización:</strong> 11 Oct 2025</p>
          <p><strong>Desarrollado por:</strong> Equipo CuidAR</p>
        </div>
      </div>
      
      <!-- Enlaces Legales -->
      <div class="sidebar-section">
        <ul class="sidebar-legal">
          <li><a href="terminos.html"><i class="fas fa-file-contract"></i> Términos y Condiciones</a></li>
          <li><a href="politicas.html"><i class="fas fa-shield-alt"></i> Política de Privacidad</a></li>
        </ul>
      </div>
    </div>
    
    <div class="sidebar-footer">
      <p>&copy; 2025 CuidAR. Todos los derechos reservados.</p>
    </div>
  </div>
  
  <!-- Overlay para el sidebar -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <nav class="bottom-nav">
    <a href="#" class="active"><i class="fas fa-home"></i></a>
    <a href="asistente.html"><i class="fas fa-search"></i></a>
    <a href="#" id="notificationsBtn" class="notifications-trigger">
      <i class="fas fa-bell"></i>
      <span class="notification-badge" id="notificationBadge">0</span>
    </a>
    <a href="perfil.html" class="nav-user-profile">
      <i class="fas fa-user" id="navUserIcon"></i>
      <img id="navUserPhoto" style="display: none;">
    </a>
  </nav>
  <script src="../JS/script.js"></script>
  <script src="../JS/notifications.js"></script>
  <script>
    // Frases rotativas
    const phrases = [
      'Cuida tu salud antes que lo pida tu cuerpo',
      'Tu bienestar es nuestra prioridad',
      'Prevenir es mejor que curar',
      'La salud es el mayor regalo',
      'Vive sano, vive feliz',
      'Tu salud, nuestro compromiso',
      'Tecnología al servicio de tu bienestar',
      'Cuidarte hoy es invertir en tu futuro',
      'La prevención salva vidas',
      'Tu salud en buenas manos'
    ];
    
    let currentPhraseIndex = 0;
    const phraseElement = document.getElementById('rotatingPhrase');
    
    function changePhrase() {
      // Efecto fade out
      phraseElement.style.opacity = '0';
      phraseElement.style.transform = 'translateY(-10px)';
      
      setTimeout(() => {
        // Cambiar frase
        currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
        phraseElement.textContent = phrases[currentPhraseIndex];
        
        // Efecto fade in
        phraseElement.style.opacity = '1';
        phraseElement.style.transform = 'translateY(0)';
      }, 500);
    }
    
    // Cambiar frase cada 4 segundos
    setInterval(changePhrase, 4000);
    
    // Efecto de lluvia de corazones
    const mainLogo = document.getElementById('mainLogo');
    const heartsContainer = document.getElementById('heartsContainer');
    let heartInterval;

    mainLogo.addEventListener('mouseenter', function() {
      heartInterval = setInterval(createHeart, 150);
    });

    mainLogo.addEventListener('mouseleave', function() {
      clearInterval(heartInterval);
    });

    function createHeart() {
      const heart = document.createElement('div');
      heart.classList.add('heart');
      heart.innerHTML = '❤️';
      
      // Posición aleatoria horizontal
      const randomX = Math.random() * 100;
      heart.style.left = randomX + '%';
      
      // Duración aleatoria de caída
      const duration = Math.random() * 2 + 2; // entre 2 y 4 segundos
      heart.style.animationDuration = duration + 's';
      
      heartsContainer.appendChild(heart);
      
      // Eliminar el corazón después de la animación
      setTimeout(() => {
        heart.remove();
      }, duration * 1000);
    }
    
    // Función para cerrar sesión
    document.getElementById('logout-btn').addEventListener('click', function() {
      if (confirm('¿Estás seguro que deseas cerrar sesión?')) {
        // Limpiar datos de sesión
        sessionStorage.clear();
        localStorage.removeItem('currentUser');
        
        // Redirigir a la página de login
        window.location.href = '../index.html';
      }
    });
    
    // Función para acceder al panel de administración
    function accessAdmin() {
      const password = prompt('🔐 Ingrese la contraseña de administrador:');
      
      if (password === null) {
        // Usuario canceló
        return;
      }
      
      if (password === '2005') {
        // Contraseña correcta - Guardar acceso en sessionStorage
        sessionStorage.setItem('adminAccess', 'true');
        sessionStorage.setItem('adminAccessTime', new Date().getTime().toString());
        alert('✅ Acceso concedido');
        window.location.href = 'admin.html';
      } else {
        // Contraseña incorrecta
        alert('❌ Contraseña incorrecta. Acceso denegado.');
      }
    }
    
    // ==================== SISTEMA DE NOTIFICACIONES ====================
    
    const notificationsPanel = document.getElementById('notificationsPanel');
    const notificationsOverlay = document.getElementById('notificationsOverlay');
    const notificationsBtn = document.getElementById('notificationsBtn');
    const closeNotifications = document.getElementById('closeNotifications');
    const notificationBadge = document.getElementById('notificationBadge');
    const notificationsBody = document.getElementById('notificationsBody');
    const clearNotificationsBtn = document.getElementById('clearNotifications');
    const notifSystem = window.notificationSystem;
    
    // Inicializar notificaciones
    initNotifications();
    
    // Abrir panel de notificaciones
    notificationsBtn.addEventListener('click', function(e) {
      e.preventDefault();
      notificationsPanel.classList.add('active');
      notificationsOverlay.classList.add('active');
      markNotificationsAsRead();
    });
    
    // Cerrar panel
    closeNotifications.addEventListener('click', closeNotificationsPanel);
    notificationsOverlay.addEventListener('click', closeNotificationsPanel);
    
    function closeNotificationsPanel() {
      notificationsPanel.classList.remove('active');
      notificationsOverlay.classList.remove('active');
    }
    
    // Limpiar todas las notificaciones
    clearNotificationsBtn.addEventListener('click', function() {
      if (confirm('¿Deseas eliminar todas las notificaciones?')) {
        notifSystem.clearAll();
        loadNotifications();
        updateBadge();
      }
    });
    
    function initNotifications() {
      // Recargar usuario actual en el sistema de notificaciones
      notifSystem.loadCurrentUser();
      
      // Cargar notificaciones existentes
      loadNotifications();
      updateBadge();
      
      // Generar notificaciones basadas en tests realizados
      notifSystem.generateHealthNotifications();
      
      // Generar notificación diaria
      notifSystem.generateDailyTip();
      
      // Recordatorio de tests
      notifSystem.remindTestIfNeeded();
      
      // Revisar cada hora si hay nuevas notificaciones
      setInterval(() => {
        notifSystem.loadCurrentUser(); // Recargar por si cambió
        notifSystem.generateDailyTip();
        notifSystem.remindTestIfNeeded();
        loadNotifications();
        updateBadge();
      }, 3600000); // 1 hora
    }
    
    function loadNotifications() {
      const notifications = notifSystem.getAll();
      
      if (notifications.length === 0) {
        notificationsBody.innerHTML = `
          <div class="no-notifications">
            <i class="fas fa-bell-slash"></i>
            <p>No tienes notificaciones</p>
          </div>
        `;
        return;
      }
      
      notificationsBody.innerHTML = notifications.map(notif => {
        const date = new Date(notif.timestamp);
        const timeAgo = notifSystem.getTimeAgo(date);
        
        return `
          <div class="notification-item ${notif.read ? 'read' : 'unread'} notification-${notif.type}">
            <div class="notification-icon">
              <i class="fas ${notif.icon}"></i>
            </div>
            <div class="notification-content">
              <h4>${notif.title}</h4>
              <p>${notif.message}</p>
              <span class="notification-time">${timeAgo}</span>
            </div>
            <button class="btn-delete-notification" onclick="deleteNotification(${notif.id})">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
      }).join('');
    }
    
    function deleteNotification(id) {
      notifSystem.delete(id);
      loadNotifications();
      updateBadge();
    }
    
    function markNotificationsAsRead() {
      notifSystem.markAllAsRead();
      updateBadge();
    }
    
    function updateBadge() {
      const unreadCount = notifSystem.countUnread();
      
      if (unreadCount > 0) {
        notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
    }
    
    // ===== MENÚ LATERAL (SIDEBAR) =====
    const menuIcon = document.querySelector('.menu-icon');
    const sidebarMenu = document.getElementById('sidebarMenu');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const closeSidebar = document.getElementById('closeSidebar');
    
    // Abrir sidebar
    if (menuIcon) {
      menuIcon.addEventListener('click', function() {
        console.log('🍔 Abriendo menú lateral');
        sidebarMenu.classList.add('active');
        sidebarOverlay.classList.add('active');
      });
    }
    
    // Cerrar sidebar con botón X
    if (closeSidebar) {
      closeSidebar.addEventListener('click', function() {
        sidebarMenu.classList.remove('active');
        sidebarOverlay.classList.remove('active');
      });
    }
    
    // Cerrar sidebar con overlay
    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', function() {
        sidebarMenu.classList.remove('active');
        sidebarOverlay.classList.remove('active');
      });
    }
  </script>
</body>
</html>
